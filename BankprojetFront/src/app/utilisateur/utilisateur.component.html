<app-sidebar></app-sidebar>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark - Gestion des Clients</title>
 
</head>


   
        <!-- Content -->
        <div class="content">
            <h1 class="page-title">List user</h1>
            <div class="breadcrumb">
               
            </div>
            
            <div class="card" style="margin-top: -670px; margin-left:250px">
                <div class="card-header">
                    <h2 class="card-title">Liste des utilisateurs</h2>
                    <div class="card-actions">
                        <button>
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>
                        <button (click)="open()" >
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="16"></line>
                                <line x1="8" y1="12" x2="16" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-controls">
                        <div class="show-entries">
                            <label>Show</label>
                            <select>
                                <option>10</option>
                                <option>25</option>
                                <option>50</option>
                                <option>100</option>
                            </select>
                            <span>entries</span>
                        </div>
                        <div class="search-control">
                            <label>Search:</label>
                            <input type="text">
                        </div>
                    </div>
                    
                    <table >
                        <thead>
                            <tr>
                                <th>Username</th>
                      
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
<tbody>
  <tr *ngFor="let user of users" [class.editing-row]="editingUserId === user.id">
    <td class="text-center">
                <span *ngIf="editingUserId !== user.id">{{ user.username }}</span>
                <input *ngIf="editingUserId === user.id" type="text" [(ngModel)]="editedUserData.username" class="inline-edit-input" />
              </td>

    <td class="text-center">
                <span *ngIf="editingUserId !== user.id">{{ user.email }}</span>
                <input *ngIf="editingUserId === user.id" type="email" [(ngModel)]="editedUserData.email" class="inline-edit-input" />
              </td>
    <td class="text-center">{{ user.role }}</td>
    <td class="status-cell text-center">
                <!-- Display Mode: Badge -->
                <ng-container *ngIf="editingUserId !== user.id">
                  <span *ngIf="user.enabled" class="status-badge status-active" style="color: rgb(28, 155, 85);" >
                    <i class="bi bi-check-circle-fill" style=" color: rgb(28, 155, 85);"></i> Activé
                  </span>
                  <span *ngIf="!user.enabled" class="status-badge status-inactive" style="color:rgb(176, 57, 57)">
                    <i class="bi bi-x-circle-fill" style="color:rgb(176, 57, 57)"></i> Désactivé
                  </span>
                </ng-container>

                <!-- Edit Mode: Toggle Switch -->
                <div *ngIf="editingUserId === user.id" class="form-check form-switch d-flex justify-content-center align-items-center h-100">
                  <input class="form-check-input" type="checkbox" role="switch"
                         id="userStatusSwitch-{{user.id}}"
                         [(ngModel)]="editedUserData.enabled"
                         [attr.aria-label]="editedUserData.enabled ? 'Désactiver le membre' : 'Activer le membre'">
                 
                </div>
              </td>
  <td class="actions text-center">
                <!-- View/Edit Mode Buttons -->
                <ng-container *ngIf="editingUserId !== user.id">
                 <button class="edit-btn" (click)="editUser(user)" title="Modifier" [disabled]="isDeletingUser === user.id">
                   <i class="bi bi-pencil"></i>
                 </button>
                 <button class="delete-btn" (click)="confirmDelete(user)" title="Supprimer" [disabled]="isDeletingUser === user.id || !!editingUserId"> <!-- Disable delete also when editing any user -->
                    <i *ngIf="isDeletingUser !== user.id" class="bi bi-trash"></i>
                    <span *ngIf="isDeletingUser === user.id" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                 </button>
               </ng-container>

               <!-- Edit Mode Buttons -->
               <ng-container *ngIf="editingUserId === user.id">
                 <!-- **** THIS IS THE IMPORTANT CHANGE **** -->
                 <button class="save-btn" (click)="saveUser()" title="Enregistrer" [disabled]="isSavingUser" >
                 <!-- **** END OF IMPORTANT CHANGE **** -->
                   <i *ngIf="!isSavingUser" class="bi bi-check-lg"></i>
                   <span *ngIf="isSavingUser" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                 </button>
                 <button class="cancel-btn" (click)="cancelEdit()" title="Annuler" [disabled]="isSavingUser">
                   <i class="bi bi-x-lg"></i>
                 </button>
               </ng-container>
             </td>
  </tr>
</tbody>
                    </table>
                </div>
            </div>
        </div>

   


</html>